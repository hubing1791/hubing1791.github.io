---
title: 数据库事务学习
author: not_you
date: 2021-04-9 22:34:00 +0800
categories: ["数据库"]
tags: [数据库]
---

### **BufferPool**

（1）**空间管理：**当执行一条sql语句时，在定位到一个页后，会把页复制到buffer pool里。一个页在放入buffer pool时，由于buffer pool里的空间可能不是连续的，innodb是这样处理的。维持一个free链表，每个节点都指向一个空白页，取第一个节点。同样的，当buffer pool里出现新的空闲时，会再添加到free链表的尾部。

（2）**脏页管理：**维护一个flush链表，和free的思路类似。

（3）**页面淘汰算法：**LRU链表实现。不过这种普通的应用淘汰算法存在一个困境，假设进行了一次全表扫描，会出现不停取页放进buffer pool从而导致其被全部换掉，这样一些本该是经常使用的热点数据就被换出去了，会降低性能。对此innodb进行了分区，将LRU链表切为5：3的冷热数据区，优先将冷数据区域作为普通的LRU使用，但是冷数据区如果有数据区在超过某个时间限制（比如1s）之后再次访问，就加入热数据区。相当于使用了两个普通的LRU。至于为什么要有时间限制，因为全表扫描时一页上不止一个数据，全表扫描会短时间内再次访问多次，用限制来回避了之前提出的困经

